<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Data Analysis: Visualizing Global Violence Since 1400 A.D. with ggplot2 and Plotly | A Philosopher’s Guide to Data Science</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="Data Analysis: Visualizing Global Violence Since 1400 A.D. with ggplot2 and Plotly" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="For this post, I wanted to look at how global violent conflict has changed over the past few centuries. According to Steven Pinker in his The Better Angels of Our Nature: Why Violence Has Declined, we’ve never lived in a safer, less-violent time than today. Are there data to support this?" />
<meta property="og:description" content="For this post, I wanted to look at how global violent conflict has changed over the past few centuries. According to Steven Pinker in his The Better Angels of Our Nature: Why Violence Has Declined, we’ve never lived in a safer, less-violent time than today. Are there data to support this?" />
<link rel="canonical" href="http://localhost:4000/datasophy/2018/07/07/global-violence.html" />
<meta property="og:url" content="http://localhost:4000/datasophy/2018/07/07/global-violence.html" />
<meta property="og:site_name" content="A Philosopher’s Guide to Data Science" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-07-07T00:00:00+08:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/datasophy/2018/07/07/global-violence.html"},"url":"http://localhost:4000/datasophy/2018/07/07/global-violence.html","description":"For this post, I wanted to look at how global violent conflict has changed over the past few centuries. According to Steven Pinker in his The Better Angels of Our Nature: Why Violence Has Declined, we’ve never lived in a safer, less-violent time than today. Are there data to support this?","headline":"Data Analysis: Visualizing Global Violence Since 1400 A.D. with ggplot2 and Plotly","@type":"BlogPosting","dateModified":"2018-07-07T00:00:00+08:00","datePublished":"2018-07-07T00:00:00+08:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/datasophy/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/datasophy/feed.xml" title="A Philosopher's Guide to Data Science" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/datasophy/">A Philosopher&#39;s Guide to Data Science</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/datasophy/about/">About</a><a class="page-link" href="/datasophy/cv/">CV</a><a class="page-link" href="/datasophy/projects/">Projects</a><a class="page-link" href="/datasophy/random/">Random</a><a class="page-link" href="/datasophy/tutorials/">Tutorials</a><a class="page-link" href="/datasophy/writing/">Writing</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Data Analysis: Visualizing Global Violence Since 1400 A.D. with ggplot2 and Plotly</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-07-07T00:00:00+08:00" itemprop="datePublished">Jul 7, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>For this post, I wanted to look at how global violent conflict has changed over the past few centuries. According to Steven Pinker in his <em>The Better Angels of Our Nature: Why Violence Has Declined</em>, we’ve never lived in a safer, less-violent time than today. Are there data to support this?</p>

<p>I managed to find an interesting dataset of world violent conflicts that has been painstakingly put together by professor Peter Brecke of the University of Utrecht. You can find the data on the “data” tab of the University of Utrecht’s Centre for Global Economic History. <a href="http://www.cgeh.nl/data#conflict">http://www.cgeh.nl/data#conflict</a></p>

<p><strong>Regarding the completeness of the conflict data, Prof. Brecke has this to say:</strong></p>

<p><em>It must be understood that the Conflict Catalog within that Excel file is an unfinished product. Taking into consideration the data I have in my office that is not yet in the Conflict Catalog, I can easily believe the catalog growing by 20% or more.</em></p>

<p><em>There are certainly errors in the data, especially as we go back in time and into particular regions of the world. I have strived mightily to make these data as correct and accurate as I can, but there are undoubtedly errors of some form or other in the file. I tried to eliminate errors and resolve inconsistencies by comparing as many sources as I could find for every datapoint in the file. I believe the number of mistakes in terms of typos is quite small.</em></p>

<p>In short, it’s a work in progress. For example, the US Civil War is not included.</p>

<p>This dataset contains approximately 3708 conflicts (rows) and 18 variables of interest. Note however that there are many many NA values. Of course, dealing with data from 1400-present day, one would expect some data sources to not be reliable. In some cases it may even be impossible to calculate accurate numbers. With these caveats in mind, we’ll do our best.</p>

<p><strong>Our Plan of Attack</strong></p>

<p>We will start by cleaning up the data a little bit and adding some important missing country names to a new variable that we can then use to group our observations by. In order to do that, we will need to leverage another table that contains country names in many different languages: the countrycode package. Once we have those, it’s a simple inner_join to add the new columns (regions and continents) using our existing country names.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">countrycode</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggmap</span><span class="p">)</span><span class="w">
</span><span class="n">options</span><span class="p">(</span><span class="n">tibble.print_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">)</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s1">'conflictcsv.csv'</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">df</span><span class="o">$</span><span class="n">Name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">Name</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##  [1] "Common.Name"     "Name"            "CountryCode"    
##  [4] "NumberActors"    "MilFatalities"   "TotalFatalities"
##  [7] "StartYear"       "StartMonth"      "StartDay"       
## [10] "EndYear"         "EndMonth"        "EndDay"         
## [13] "Region"          "Century"         "Decade"         
## [16] "DurationD"       "DurationM"       "DurationY"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#great little package that includes regex examples for extracting countries</span><span class="w">
</span><span class="n">codes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="n">countrycode</span><span class="o">::</span><span class="n">codelist</span><span class="o">$</span><span class="n">country.name.en</span><span class="p">)</span><span class="w">

</span><span class="c1">#add these because they are not the standard country names but will represent geographic regions in our plots</span><span class="w">
</span><span class="n">codes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'england'</span><span class="p">,</span><span class="w"> </span><span class="s1">'burma'</span><span class="p">,</span><span class="s1">'korea'</span><span class="p">,</span><span class="s1">'zaire'</span><span class="p">,</span><span class="w"> </span><span class="s1">'crimea'</span><span class="p">,</span><span class="w"> </span><span class="s1">'milan'</span><span class="p">,</span><span class="w"> </span><span class="s1">'america'</span><span class="p">,</span><span class="w"> </span><span class="s1">'west indies'</span><span class="p">,</span><span class="w">
                        </span><span class="s1">'guiana'</span><span class="p">,</span><span class="w"> </span><span class="s1">'guatamala'</span><span class="p">,</span><span class="w"> </span><span class="s1">'palestine'</span><span class="p">,</span><span class="w">
                        </span><span class="s1">'soviet union'</span><span class="p">,</span><span class="w"> </span><span class="s1">'ussr'</span><span class="p">,</span><span class="w"> </span><span class="s1">'congo'</span><span class="p">,</span><span class="w"> </span><span class="s1">'britain'</span><span class="p">,</span><span class="w"> </span><span class="s1">'persia'</span><span class="p">,</span><span class="w"> </span><span class="s1">'us'</span><span class="p">,</span><span class="w">
                        </span><span class="s1">'holland'</span><span class="p">,</span><span class="w"> </span><span class="s1">'ceylon'</span><span class="p">,</span><span class="s1">'sumatrans'</span><span class="p">,</span><span class="w"> </span><span class="s1">'transylvania'</span><span class="p">,</span><span class="w"> </span><span class="s1">'united provinces'</span><span class="p">,</span><span class="w">
                        </span><span class="s1">'scotland'</span><span class="p">,</span><span class="w"> </span><span class="s1">'algiers'</span><span class="p">,</span><span class="s1">'florence'</span><span class="p">,</span><span class="w"> </span><span class="s1">'burgundy'</span><span class="p">,</span><span class="w"> </span><span class="s1">'bohemia'</span><span class="p">,</span><span class="w"> </span><span class="s1">'naples'</span><span class="p">,</span><span class="w">
                        </span><span class="s1">'burmese'</span><span class="p">,</span><span class="w"> </span><span class="s1">'zurich'</span><span class="p">,</span><span class="w"> </span><span class="s1">'aragon'</span><span class="p">,</span><span class="w"> </span><span class="s1">'sicily'</span><span class="p">,</span><span class="w"> </span><span class="s1">'siam'</span><span class="p">,</span><span class="w"> </span><span class="s1">'tibet'</span><span class="p">,</span><span class="w"> </span><span class="s1">'venice'</span><span class="p">,</span><span class="w">
                        </span><span class="s1">'mongols'</span><span class="p">,</span><span class="w"> </span><span class="s1">'german'</span><span class="p">,</span><span class="w"> </span><span class="s1">'swiss'</span><span class="p">,</span><span class="w"> </span><span class="s1">'castile'</span><span class="p">,</span><span class="w"> </span><span class="s1">'emperor'</span><span class="p">,</span><span class="w"> </span><span class="s1">'papal'</span><span class="p">,</span><span class="w">
                        </span><span class="s1">'british'</span><span class="p">,</span><span class="w"> </span><span class="s1">'boers'</span><span class="p">,</span><span class="w"> </span><span class="s1">'bengal'</span><span class="p">,</span><span class="w"> </span><span class="s1">'portuguese'</span><span class="p">,</span><span class="w"> </span><span class="s1">'moghuls'</span><span class="p">,</span><span class="w"> </span><span class="s1">'zulu'</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">codes</span><span class="p">))</span><span class="w">

</span><span class="c1">#turn it into a DF for joining</span><span class="w">
</span><span class="n">cl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">codelist</span><span class="w">

</span><span class="c1">#convert all names to lowercase</span><span class="w">
</span><span class="n">cl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cl</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate_if</span><span class="p">(</span><span class="n">is.character</span><span class="p">,</span><span class="w"> </span><span class="n">tolower</span><span class="p">)</span><span class="w">
  

</span><span class="c1">#find name from description and add new column with name value. 430 missing this way</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">str_extract</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s2">"|"</span><span class="p">))))</span><span class="w">

</span><span class="c1">#need continent and region labels for plotting. Have to join from other dataframe.</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="s1">'country.name.en'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">inner_join</span><span class="p">(</span><span class="n">cl</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'region'</span><span class="p">,</span><span class="s1">'continent'</span><span class="p">,</span><span class="w"> </span><span class="s1">'country.name.en'</span><span class="p">)],</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s1">'country.name.en'</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="s1">'country'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country.name.en</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h1 id="set-up-our-maps-with-ggmap">Set up our maps with ggmap()</h1>

<p>I don’t know why, but sometimes these don’t work the first time. If I run them again, however, they will work.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Map of EU</span><span class="w">
</span><span class="n">world_map_eur</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_map</span><span class="p">(</span><span class="s1">'Europe'</span><span class="p">,</span><span class="w"> </span><span class="n">zoom</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="o">%&gt;%</span><span class="n">ggmap</span><span class="p">()</span><span class="w">
</span><span class="n">world_map_eur</span><span class="w">
</span></code></pre></div></div>

<p><img src="globalconf_files/figure-markdown_github/unnamed-chunk-2-1.png" alt="" /></p>

<p>Since the Google Maps API only allows 2500 geocoordinate queries per day, we will go old school and scrape the coordinates from this handy Google html table that lists the country name and the latitude and longitude. These coordinates will allow us to plot on a world map. Otherwise we could use the handy mutate_geocode() function from gmaps.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#COLLECT LATITUDE AND LONGITUDE DATA FROM WEB</span><span class="w">
</span><span class="c1">#html_table is super useful because it will format a dataframe from an html table</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rvest</span><span class="p">)</span><span class="w">
</span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s1">'https://developers.google.com/public-data/docs/canonical/countries_csv'</span><span class="w">
</span><span class="n">tab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">html_table</span><span class="p">(</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">))[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">tab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tab</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="n">name</span><span class="p">))</span><span class="w">

</span><span class="c1">#JOIN SCRAPED COORDS WITH DATA</span><span class="w">
</span><span class="c1">#Now we have country, continent, region, and lat longitudes</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="s1">'name'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">inner_join</span><span class="p">(</span><span class="n">tab</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'latitude'</span><span class="p">,</span><span class="s1">'longitude'</span><span class="p">,</span><span class="s1">'name'</span><span class="p">)],</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s1">'name'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>We have the data required for plotting, now we just need to compute some summary statistics to display. To start, let’s look at the number of conflicts around the world since 1400.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Latitudes for regions and countries for plotting. READY TO PLOT!</span><span class="w">
</span><span class="n">lat_long_conf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">long</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">),</span><span class="w">
            </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">),</span><span class="w">
            </span><span class="n">num_conflicts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">lat_long_conf</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 6 x 5
## # Groups:   name [6]
##          name          region       long       lat num_conflicts
##         &lt;chr&gt;           &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;         &lt;int&gt;
## 1 afghanistan   southern asia  67.709953  33.93911            61
## 2     albania southern europe  20.168331  41.15333            10
## 3     algeria northern africa   1.659626  28.03389            11
## 4      angola   middle africa  17.873887 -11.20269            15
## 5   argentina   south america -63.616672 -38.41610            26
## 6     armenia    western asia  45.038189  40.06910             1
</code></pre></div></div>

<p>We’re not done yet. We need a world map to plot on. We also need a dataframe with the latitude and longitude information. We obtain this using the maps library and the map_data() function that creates a dataframe with region and longitude and latitude information. We pass these into the call to geom_map().</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">maps</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">world_map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">map_data</span><span class="p">(</span><span class="s1">'world'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">world_map</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##        long      lat group order region subregion
## 1 -69.89912 12.45200     1     1  Aruba      &lt;NA&gt;
## 2 -69.89571 12.42300     1     2  Aruba      &lt;NA&gt;
## 3 -69.94219 12.43853     1     3  Aruba      &lt;NA&gt;
## 4 -70.00415 12.50049     1     4  Aruba      &lt;NA&gt;
## 5 -70.06612 12.54697     1     5  Aruba      &lt;NA&gt;
## 6 -70.05088 12.59707     1     6  Aruba      &lt;NA&gt;
</code></pre></div></div>

<p>Simply overlay these data on our ggplot world map. Notice the map=world_map and aes(map_id=region) arguments.</p>

<p>Let’s look at conflicts by region.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">ggplot</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_map</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">world_map</span><span class="p">,</span><span class="w"> </span><span class="n">map</span><span class="o">=</span><span class="n">world_map</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span><span class="n">map_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">region</span><span class="p">),</span><span class="w">
           </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lat_long_conf</span><span class="p">,</span><span class="w">
             </span><span class="n">aes</span><span class="p">(</span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="n">num_conflicts</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">.5</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Violent conflicts since 1400 AD'</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="globalconf_files/figure-markdown_github/unnamed-chunk-6-1.png" alt="" /></p>

<p>From this we can see that Europe is a hotbed, along with modern day China, the Middle East, and Central America. Africa has had conflicts in almostevery country, though the total number of conflicts is dwarfed by Europe and China.</p>

<h1 id="conflicts-over-the-centuries">Conflicts over the centuries</h1>

<p>Now we want to look more at the number of conflicts through the centuries. In order to do that we must turn our semi-continuous variable StartYear into a discrete variable with values for each century. To do this we will use the cut() function that takes two key arguments: the break values in the actual variable, and the labels for each break. Notice that there is one fewer label than break values.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#create copy of original df</span><span class="w">
</span><span class="n">df_cut</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w">
</span><span class="n">df_cut</span><span class="o">$</span><span class="n">StartYear</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">cut</span><span class="p">(</span><span class="n">df_cut</span><span class="o">$</span><span class="n">StartYear</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1400</span><span class="p">,</span><span class="w"> </span><span class="m">1500</span><span class="p">,</span><span class="w"> </span><span class="m">1600</span><span class="p">,</span><span class="w"> </span><span class="m">1700</span><span class="p">,</span><span class="w"> </span><span class="m">1800</span><span class="p">,</span><span class="w"> </span><span class="m">1900</span><span class="p">,</span><span class="w"> </span><span class="m">2001</span><span class="p">),</span><span class="w">
      </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'1400-1499'</span><span class="p">,</span><span class="w"> </span><span class="s1">'1500-1599'</span><span class="p">,</span><span class="w"> </span><span class="s1">'1600-1699'</span><span class="p">,</span><span class="w"> </span><span class="s1">'1700-1799'</span><span class="p">,</span><span class="w">
                 </span><span class="s1">'1800-1899'</span><span class="p">,</span><span class="w"> </span><span class="s1">'1900-2001'</span><span class="p">),</span><span class="w">
      </span><span class="n">right</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">ordered_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="n">df_cut</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">StartYear</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">head</span><span class="p">(</span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##                                                           Name StartYear
## 1 china (minority in hebei, shandong, anhui, jiangsu), 1400-02 1400-1499
## 2                                                hungary, 1401 1400-1499
## 3                                    russia-lithuania, 1401-04 1400-1499
## 4                        mujapahit (india, civil war), 1401-06 1400-1499
## 5                      china-japanese pirates (zhejiang), 1401 1400-1499
</code></pre></div></div>

<p>We will then look at the number of conflicts by each present day country.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#get conflicts by continent</span><span class="w">
</span><span class="n">year_conf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_cut</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">StartYear</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">continent</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">long</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">),</span><span class="w">
            </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">),</span><span class="w">
            </span><span class="n">num_conflicts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">year_conf</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 6 x 6
## # Groups:   StartYear, name [6]
##   StartYear         name continent      long      lat num_conflicts
##       &lt;ord&gt;        &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;         &lt;int&gt;
## 1 1400-1499  afghanistan      asia 67.709953 33.93911             2
## 2 1400-1499      albania    europe 20.168331 41.15333             3
## 3 1400-1499      algeria    africa  1.659626 28.03389             1
## 4 1400-1499      austria    europe 14.550072 47.51623             3
## 5 1400-1499        benin    africa  2.315834  9.30769             1
## 6 1400-1499 burkina faso    africa -1.561593 12.23833             1
</code></pre></div></div>

<p>Now we take the computed numbers and overlay them, via ggplot, on our world map. To do this, we need to use the geom_map function and pass in our world_map as the data and as the map. Notice in the aes() function we pass in the map_id = region argument. After that, it’s like building any old ggplot2 chart.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">ggplot</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_map</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">world_map</span><span class="p">,</span><span class="w"> </span><span class="n">map</span><span class="o">=</span><span class="n">world_map</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">map_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">region</span><span class="p">),</span><span class="w">
           </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">year_conf</span><span class="p">,</span><span class="w">
             </span><span class="n">aes</span><span class="p">(</span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="n">num_conflicts</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">.5</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Violent conflicts since 1400 AD'</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">StartYear</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="globalconf_files/figure-markdown_github/unnamed-chunk-9-1.png" alt="" /></p>

<p>We see that before Europe expanded to the Americas there were very few violent conflicts outside of Europe (besides China). As Europeans arrived in North and South America, more conflicts arose. Interestingly, in the 17th century, fewer new conflicts occurred in the New World, though Russia and West Africa experienced conflicts. Then in the 18th century, more and more violence broke out in North and South America. In the 19th century, the Americas became a powder keg for military conflict. At the same time, Europe and Africa blew up. Finally in the 20th century we see a pretty even distribution of conflicts all over the map. The Middle East also seems to have grown more violent (as measured by number of conflicts).</p>

<p>Notice that the increase in conflicts over the centuries is probably due to better recording of conflicts, not simply because people are more violent.</p>

<p>If we want a better map, we can use our Google map and limit the area to Europe.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">eu_conf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">year_conf</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">continent</span><span class="o">==</span><span class="s1">'europe'</span><span class="p">)</span><span class="w">

</span><span class="n">world_map_eur</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">eu_conf</span><span class="p">,</span><span class="w">
             </span><span class="n">aes</span><span class="p">(</span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="n">num_conflicts</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Violent conflicts since 1400 AD'</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">StartYear</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="globalconf_files/figure-markdown_github/unnamed-chunk-10-1.png" alt="" /></p>

<p>It looks like the 19th century was a particularly bloody time in Europe, with the Napoleonic wars probably contributing to most of that.</p>

<h1 id="closer-look-conflicts-in-the-20th-century">Closer look: Conflicts in the 20th century</h1>

<p>Let’s say we are interested in examining conflicts in the 20th century. We will do the same process for cutting and relabeling the dates.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">df1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s1">'conflictcsv.csv'</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">df1</span><span class="o">$</span><span class="n">Name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="n">df1</span><span class="o">$</span><span class="n">Name</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#great little package that includes regex examples for extracting countries</span><span class="w">
</span><span class="n">codes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="n">countrycode</span><span class="o">::</span><span class="n">codelist</span><span class="o">$</span><span class="n">country.name.en</span><span class="p">)</span><span class="w">

  
</span><span class="c1">#FIRST CREATE A DF OF ONLY 1900+ EVENTS</span><span class="w">
</span><span class="c1">#803 obs</span><span class="w">
</span><span class="n">df_1900</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">StartYear</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">1900</span><span class="p">)</span><span class="w">

</span><span class="c1">#Have to use 1 fewer label than the breaks. so binned from 1990+</span><span class="w">
</span><span class="n">df_1900</span><span class="o">$</span><span class="n">StartYear</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">cut</span><span class="p">(</span><span class="n">df_1900</span><span class="o">$</span><span class="n">StartYear</span><span class="p">,</span><span class="w"> 
                          </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1900</span><span class="p">,</span><span class="m">1910</span><span class="p">,</span><span class="w"> </span><span class="m">1920</span><span class="p">,</span><span class="m">1930</span><span class="p">,</span><span class="m">1940</span><span class="p">,</span><span class="m">1950</span><span class="p">,</span><span class="m">1960</span><span class="p">,</span><span class="m">1970</span><span class="p">,</span><span class="m">1980</span><span class="p">,</span><span class="m">1990</span><span class="p">,</span><span class="m">2001</span><span class="p">),</span><span class="w">
      </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'1900-1909'</span><span class="p">,</span><span class="w"> </span><span class="s1">'1910-1919'</span><span class="p">,</span><span class="w"> </span><span class="s1">'1920-1929'</span><span class="p">,</span><span class="w"> </span><span class="s1">'1930-1939'</span><span class="p">,</span><span class="w">
                 </span><span class="s1">'1940-1949'</span><span class="p">,</span><span class="w"> </span><span class="s1">'1950-1959'</span><span class="p">,</span><span class="w"> </span><span class="s1">'1960-1969'</span><span class="p">,</span><span class="w"> </span><span class="s1">'1970-1979'</span><span class="p">,</span><span class="w"> </span><span class="s1">'1980-1989'</span><span class="p">,</span><span class="w">
                 </span><span class="s1">'1990+'</span><span class="p">),</span><span class="w">
      </span><span class="n">right</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">ordered_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">df_1900</span><span class="o">$</span><span class="n">StartYear</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] 1900-1909 1900-1909 1900-1909 1900-1909 1900-1909 1900-1909
## 10 Levels: 1900-1909 &lt; 1910-1919 &lt; 1920-1929 &lt; 1930-1939 &lt; ... &lt; 1990+
</code></pre></div></div>

<p>We do the same thing again: use regular expressions to find matches from our vector of country names and then create a new column with the matched value.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#First extract names from the list of Name field</span><span class="w">
</span><span class="c1">#430 missing this wway</span><span class="w">
</span><span class="n">df_1900</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_1900</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">str_extract</span><span class="p">(</span><span class="n">df_1900</span><span class="o">$</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s2">"|"</span><span class="p">))))</span><span class="w">


</span><span class="c1">#need continent and region labels for plotting. Have to join from other dataframe.</span><span class="w">
</span><span class="n">df_1900</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_1900</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="s1">'country.name.en'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">inner_join</span><span class="p">(</span><span class="n">cl</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'region'</span><span class="p">,</span><span class="s1">'continent'</span><span class="p">,</span><span class="w"> </span><span class="s1">'country.name.en'</span><span class="p">)],</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s1">'country.name.en'</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="s1">'country'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country.name.en</span><span class="p">)</span><span class="w">

</span><span class="c1">#Now append long and lat from google</span><span class="w">
</span><span class="c1">#Now we have country, continent, region, and lat longitudes</span><span class="w">
</span><span class="n">df_1900</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_1900</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">rename</span><span class="p">(</span><span class="s1">'name'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">inner_join</span><span class="p">(</span><span class="n">tab</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'latitude'</span><span class="p">,</span><span class="s1">'longitude'</span><span class="p">,</span><span class="s1">'name'</span><span class="p">)],</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s1">'name'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>If we want to look at continent conflict numbers in the 20th century, we simply group by country and StartYear.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#get conflicts by country</span><span class="w">
</span><span class="n">conf_1900</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_1900</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">StartYear</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">long</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">),</span><span class="w">
            </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">),</span><span class="w">
            </span><span class="n">num_conflicts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">conf_1900</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 6 x 5
## # Groups:   StartYear [1]
##   StartYear     name      long        lat num_conflicts
##       &lt;ord&gt;    &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;         &lt;int&gt;
## 1 1900-1909   angola  17.87389 -11.202692             1
## 2 1900-1909   brazil -51.92528 -14.235004             1
## 3 1900-1909  burundi  29.91889  -3.373056             2
## 4 1900-1909 cameroon  12.35472   7.369722             1
## 5 1900-1909    china 104.19540  35.861660             3
## 6 1900-1909 colombia -74.29733   4.570868             1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#20th Century Conflicts</span><span class="w">
</span><span class="n">ggplot</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_map</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">world_map</span><span class="p">,</span><span class="w"> </span><span class="n">map</span><span class="o">=</span><span class="n">world_map</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">map_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">region</span><span class="p">),</span><span class="w">
           </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">conf_1900</span><span class="p">,</span><span class="w">
             </span><span class="n">aes</span><span class="p">(</span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="n">num_conflicts</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">.5</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Violent Conflicts in the 20th Century'</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">StartYear</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="globalconf_files/figure-markdown_github/unnamed-chunk-13-1.png" alt="" /></p>

<p>This chart has a wealth of information. Starting in the first decade we see most conflicts in Europe, central Africa, and Russia. Then WWI breaks out in Europe and Northern Africa. At the same time, there’s a civil war in China and Russia that will eventually leave the Communists in power and will influence international geopolitics for the next 70+ years. Note that in 1911 the Republic of China was established, ending the millenia of rule by emperor. In the 1920s we see relative calm, except in China where civil war broke out in the late 1920s and led to the KMT fleeing to Taiwan and the Communists ruling Chinese politics until the present day.</p>

<p>The outbreak of WWII is reflected in the 1930s by a fairly global distribution of conflicts. The 1950s saw the Korean war. At this point the Cold War was at its peak: you can see the emergence of the “Third World” in Africa–countries that were aligned with neither the USA nor the Soviet Union. Lots of conflicts cropped up in Africa at this time. In the 1970s East Africa became a hotbed, and unfortunately I don’t know much about these events. Could it be related to the change of Rhodesia to Zimbabwe? It might be.</p>

<p>The 1980s see an explosion of conflict in Central America: this is probably related to the USA’s involvement in the region’s politics, including the Iran-Contra scandal that Reagan resided over. In essence the US was arming the Contras in Nicaragua using money from arms sales to Iran, which at the time, was under embargo for the taking of US hostages in 1979. Check out the Ben Affleck movie <em>Argo</em> if you’re interested in learning more about the event (or read a book!). Finally, the 1990s saw an explosion of conflict predominantly in the Middle East and what appears to be India. Unfortunately I don’t know enough about Indian history to explain what was happening here.</p>

<p>So we’ve seen the number of conflicts, what about the total deaths from these conflicts?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">)</span><span class="w">
</span><span class="c1"># Take top 30 to plot names</span><span class="w">
</span><span class="n">df_conflicts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">TotalFatalities</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">Common.Name</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span><span class="w"> </span><span class="s1">'?'</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">Common.Name</span><span class="p">,</span><span class="w"> </span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">TotalFatalities</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">TotalFatalities</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">slice</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">50</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">df_conflicts</span><span class="o">$</span><span class="n">Common.Name</span><span class="p">,</span><span class="w"> </span><span class="n">df_conflicts</span><span class="o">$</span><span class="n">TotalFatalities</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##      [,1]                            [,2]     
## [1,] "Genocide of Jews"              "6000000"
## [2,] "Taiping Rebellion"             "2000000"
## [3,] "War of the Spanish Revolution" "2000000"
## [4,] "Sino-Japanese War"             "2000000"
## [5,] "Politicide of defeated"        "1900000"
## [6,] "Politicide of opponents"       "1900000"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_map</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">world_map</span><span class="p">,</span><span class="w"> </span><span class="n">map</span><span class="o">=</span><span class="n">world_map</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">map_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">region</span><span class="p">),</span><span class="w">
           </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"light grey"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text_repel</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_conflicts</span><span class="p">,</span><span class="w">
             </span><span class="n">aes</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="n">Common.Name</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="n">TotalFatalities</span><span class="p">),</span><span class="w">
             </span><span class="n">segment.alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.6</span><span class="p">,</span><span class="w"> </span><span class="n">segment.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'black'</span><span class="p">,</span><span class="w">
             </span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">expand_limits</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="m">-80</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="m">-30</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Name and Location of Major Violent Conflicts since 1400 AD'</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="globalconf_files/figure-markdown_github/unnamed-chunk-14-1.png" alt="" /></p>

<p>We can see the genocide of the Jews, the Spanish Revolution, the Chinese Civil War, and a few other conflicts make up the worst conflicts in terms of total deaths. It’s interesting to see the Indonesia genocide of Chinese and Communists, which started under Sukarno and led to the ascension of Suharto, who would control Indonesia for the next 30 years. I don’t think this event gets enough attention in world history. And again, it shows how the Cold War shaped the 20th century.</p>

<h1 id="using-regular-expressions-to-find-attackers-and-defenders-in-conflicts">Using regular expressions to find attackers and defenders in conflicts</h1>

<p>One question we might ask is, Which countries seem to attack other countries? And, Which countries have lots of domestic conflicts?</p>

<p>To do this (and the method is not perfect, but good enough), we need to use regular expressions to extract out the names from the ‘Name’ column. A useful bit of info from the data curator’s website says that if there was an aggressor, it is listed on the left side of the hyphen and the country/nation/state under attack is on the right. So for example, element three says that Russia attacked Lithuania in 1401. Here’s a sample of the names:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">Name</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## [1] "china (minority in hebei, shandong, anhui, jiangsu), 1400-02"
## [2] "hungary, 1401"                                               
## [3] "russia-lithuania, 1401-04"                                   
## [4] "mujapahit (india, civil war), 1401-06"                       
## [5] "china-japanese pirates (zhejiang), 1401"                     
## [6] "spain-canary islands, 1402-22"
</code></pre></div></div>

<p>You can already see some problems: not all elements have attackers and defenders (some are domestic conflicts). Also, if you look carefully, there are two hyphens: one for the countries and another used in the date. So we have to be careful about which hyphen we are extracting around.</p>

<p>With a bit of trial and error (and StackOverflow), I managed to come up with two regexes that work pretty well to capture the attacker and defender.</p>

<p>Basically the first regex is going to capture any characters in the range a-z up until it hits a non-alphabetic symbol, i.e., () or -.</p>

<p>The second uses what’s called a “lookaround” and character classes (\w). It is looking for one or more word characters (\w+), preceeded by a hyphen and a word character. It might be easier to understand if you read it from right to left.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">attacker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_extract</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">Name</span><span class="p">,</span><span class="s1">'[a-z]+'</span><span class="p">))</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">defender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_extract</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="s1">'(?&lt;=\\w-)\\w+'</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">attacker</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">defender</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##      [,1]        [,2]       
## [1,] "china"     "02"       
## [2,] "hungary"   NA         
## [3,] "russia"    "lithuania"
## [4,] "mujapahit" "06"       
## [5,] "china"     "japanese" 
## [6,] "spain"     "canary"
</code></pre></div></div>

<p>The problem we have now is that some conflicts don’t have foreign defenders. So we will need to first look for any NA values or numeric values that were incorrectly extracted from our regex and convert them to the string ‘domestic.’</p>

<p>One useful technique is using lapply when you want to replace one value in one particular column or group of columns. If your function is more complicated than a one-liner, you can write the function then use lapply to target the particular column of interest.</p>

<p>First we replace NA values with ‘domestic.’ Then we replace digits with ‘domestic’ (indicating there was no 2nd country to extract a name from).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#HOW TO REPLACE NAs IN JUST ONE COLLUMN ? lapply</span><span class="w">
</span><span class="n">df</span><span class="o">$</span><span class="n">defender</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">df</span><span class="p">[,</span><span class="s1">'defender'</span><span class="p">],</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="n">replace</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="s1">'domestic'</span><span class="p">)})</span><span class="w">

</span><span class="c1">#easier to just name them domestic</span><span class="w">
</span><span class="n">check_char</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">str_detect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s1">'\\d'</span><span class="p">)</span><span class="o">==</span><span class="kc">TRUE</span><span class="p">){</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s1">'domestic'</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="p">{</span><span class="w">
    </span><span class="n">x</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">#use sapply to avoid getting a list for the column</span><span class="w">
</span><span class="n">df</span><span class="o">$</span><span class="n">defender</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">df</span><span class="p">[,</span><span class="s1">'defender'</span><span class="p">],</span><span class="w"> </span><span class="n">check_char</span><span class="p">)</span><span class="w">

</span><span class="c1">#Now this looks much better</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">attacker</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">defender</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##      [,1]        [,2]       
## [1,] "china"     "domestic" 
## [2,] "hungary"   "domestic" 
## [3,] "russia"    "lithuania"
## [4,] "mujapahit" "domestic" 
## [5,] "china"     "japanese" 
## [6,] "spain"     "canary"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Another useful way to replace specific values: str_replace_all()</span><span class="w">
</span><span class="c1">#df$defender &lt;- str_replace_all(df$defender, 'None', 'domestic')</span><span class="w">
</span></code></pre></div></div>

<p>Which countries have the most domestic conflicts?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">(</span><span class="n">attacker</span><span class="p">,</span><span class="w"> </span><span class="n">defender</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">head</span><span class="p">(</span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 5 x 3
##   attacker defender     n
##      &lt;chr&gt;    &lt;chr&gt; &lt;int&gt;
## 1    china domestic   320
## 2   france domestic    62
## 3    japan domestic    62
## 4    spain domestic    54
## 5   turkey domestic    48
</code></pre></div></div>

<p>What about which countries have the biggest rivalries, measured in terms of the number of conflicts between them? And in which centuries did these rivalries take place?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">defender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'domestic'</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">unite</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="s1">'attacker'</span><span class="p">,</span><span class="w"> </span><span class="s1">'defender'</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s1">' vs.'</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="w">  </span><span class="n">sort</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">slice</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">40</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">reorder</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">n</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_col</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="o">+</span><span class="w"> 
  </span><span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> 
    </span><span class="n">plot.caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> 
    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w"> 
    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Warring Countries"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# of Conflicts"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Century"</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">scale_fill_distiller</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Spectral'</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Most violent rivalries by # conflicts'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="globalconf_files/figure-markdown_github/unnamed-chunk-19-1.png" alt="" /></p>

<p>We can see China and the Tartars have had many conflicts over the years. We can also understand why there is hostility between Japan and China and France and England. There’s definitely some lesser-known conflicts that would be worth learning more about, for example Oman and Portugal or Russia and the Buryats, which are a group of people indigenous to Siberia.</p>

<p>Let’s see how the rankings change when we look at total fatalities. Keep in mind we don’t have a lot of data on total fatalities. These rankings are only based on the non-NA values in the dataset.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Same thing but by total fatalities</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">TotalFatalities</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">defender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'domestic'</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">unite</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="s1">'attacker'</span><span class="p">,</span><span class="w"> </span><span class="s1">'defender'</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s1">' vs.'</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">total_deaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">TotalFatalities</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">slice</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">40</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">reorder</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">total_deaths</span><span class="p">),</span><span class="n">total_deaths</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">total_deaths</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_col</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="o">+</span><span class="w"> 
  </span><span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> 
    </span><span class="n">plot.caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> 
    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w"> 
    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Warring Countries"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# of Deaths"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Century"</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">scale_fill_distiller</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Spectral'</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Most violent rivalries by # deaths'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="globalconf_files/figure-markdown_github/unnamed-chunk-20-1.png" alt="" /></p>

<p>Given our limited death data, we can see the effects of the Napoleonic wars on Europe with Austria and France being intense rivals. Lesser-known (to me at least) is China and the Dzoungars. According to Wikipedia, this was a mass genocide of Buddhist people living in Mongolia under the Manchu dynasty.</p>

<p>What about domestic conflicts: revolutions, civil wars, genocides, rebellions, etc.?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">defender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'domestic'</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">attacker</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'south'</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">(</span><span class="n">attacker</span><span class="p">,</span><span class="n">defender</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">slice</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">40</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">reorder</span><span class="p">(</span><span class="n">attacker</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">n</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_col</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> 
    </span><span class="n">plot.caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> 
    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">),</span><span class="w"> 
    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Country"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# of Domestic Conflicts"</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">scale_fill_distiller</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Spectral'</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span><span class="w">
    </span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="globalconf_files/figure-markdown_github/unnamed-chunk-21-1.png" alt="" /></p>

<p>China and Japan have dealt with many domestic conflicts over the years.</p>

<p>Maybe we’re interested in the countries whose conflicts have produced the most deaths. Keep in mind our regex was not perfect, so some of these results should be taken with a grain of salt.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#total deaths (all types)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">attacker</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'south'</span><span class="p">,</span><span class="w"> </span><span class="s1">'north'</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">TotalFatalities</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">(</span><span class="n">TotalFatalities</span><span class="p">,</span><span class="n">attacker</span><span class="p">,</span><span class="n">defender</span><span class="p">,</span><span class="n">StartYear</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">TotalFatalities</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">100000</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">reorder</span><span class="p">(</span><span class="n">attacker</span><span class="p">,</span><span class="n">TotalFatalities</span><span class="p">),</span><span class="n">TotalFatalities</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">StartYear</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_col</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> 
    </span><span class="n">plot.caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> 
    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">),</span><span class="w"> 
    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Country"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Total Deaths (all types)"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Century"</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scales</span><span class="o">::</span><span class="n">comma</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="globalconf_files/figure-markdown_github/unnamed-chunk-22-1.png" alt="" /></p>

<p>The reason Japan and Germany are listed so high is because they are being counted as “attackers” in WWII, which explains the massive amount of deaths in the 20th century. It’s interesting to see that 400 years ago, Denmark was a pretty violent place, and so was France a couple hundred years ago.</p>

<p>The deadliest domestic conflicts?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#total deaths (domestic) : keep in mind we don't have numbers for a lot o conflicts.</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">defender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'domestic'</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">attacker</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'south'</span><span class="p">,</span><span class="w"> </span><span class="s1">'north'</span><span class="p">,</span><span class="w"> </span><span class="s1">'el'</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">TotalFatalities</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">attacker</span><span class="p">,</span><span class="w"> </span><span class="n">defender</span><span class="p">,</span><span class="w"> </span><span class="n">StartYear</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">cts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">TotalFatalities</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">cts</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">70000</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">slice</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">40</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">reorder</span><span class="p">(</span><span class="n">attacker</span><span class="p">,</span><span class="n">cts</span><span class="p">),</span><span class="n">cts</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">StartYear</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_col</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> 
    </span><span class="n">plot.caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> 
    </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> 
    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Country"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Total Deaths"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Century"</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="w"> </span><span class="s1">'Total Deaths in Domestic Conflicts'</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scales</span><span class="o">::</span><span class="n">comma</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="globalconf_files/figure-markdown_github/unnamed-chunk-23-1.png" alt="" /></p>

<p>Poland had some domestic conflicts several hundred years ago, and same with the Moghuls in present day India. You can also see Portugal’s violent role in the European colonization of Asia in the 15-17th centuries.</p>

<h1 id="using-plotly-to-make-interactive-visualizations">Using Plotly to make Interactive Visualizations</h1>

<p>To use plotly with ggplot2 is easy: you just create your normal ggplot object, save it to a variable, then pass it to ggplotly(). Voila, you have an interactive plot that can be scrolled through, zoomed in on, and filtered on using different variables.</p>

<p>I want to look at the number of conflicts over time for each continent. We’ll use lubridate’s ymd() and floor_date() to aggregate into 10 year blocks.</p>

<p>The truncated parameter of ymd() is a very useful in that it checks for incomplete dates. Notice that it assumes January 1st for each year. That’s good enough for us (sorry history buffs). Once we have the date integers converted into datetime objects, we can then use the floor_date() function to aggregate them.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w">
</span><span class="n">yr_conflicts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">StartYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ymd</span><span class="p">(</span><span class="n">StartYear</span><span class="p">,</span><span class="w"> </span><span class="n">truncated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">StartYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">floor_date</span><span class="p">(</span><span class="n">StartYear</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'10 years'</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">StartYear</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">cts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">StartYear</span><span class="p">,</span><span class="w"> </span><span class="n">cts</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">continent</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w">
</span><span class="n">yr_conflicts</span><span class="w">
</span></code></pre></div></div>

<p><img src="globalconf_files/figure-markdown_github/unnamed-chunk-25-1.png" alt="" /></p>

<p>To show off plotly, I’ll do the same plot but render it using plotly with the ggplotly() function. The plot should now be fully interactive.</p>

<p><em>I’m not sure why, but twice RStudio has crashed while I’ve been playing around with the interactive graph</em></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yr_conflicts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">StartYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ymd</span><span class="p">(</span><span class="n">StartYear</span><span class="p">,</span><span class="w"> </span><span class="n">truncated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">StartYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">floor_date</span><span class="p">(</span><span class="n">StartYear</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'10 years'</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">StartYear</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">cts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">StartYear</span><span class="p">,</span><span class="w"> </span><span class="n">cts</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">continent</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">'Year of Conflict'</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s1">'Number of Conflicts'</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w">

</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">world_map_small</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">world_map</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="n">region</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">region</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">name</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">region</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">slice</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="n">label_map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">ggplot</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_map</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">world_map_small</span><span class="p">,</span><span class="w"> </span><span class="n">map</span><span class="o">=</span><span class="n">world_map</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">map_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">region</span><span class="p">),</span><span class="w">
           </span><span class="n">fill</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lat_long_conf</span><span class="p">,</span><span class="w">
             </span><span class="n">aes</span><span class="p">(</span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="n">num_conflicts</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">.5</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Violent conflicts since 1400 AD'</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span><span class="w">


</span><span class="n">plot1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplotly</span><span class="p">(</span><span class="n">yr_conflicts</span><span class="p">)</span><span class="w">
</span><span class="n">options</span><span class="p">(</span><span class="n">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'false'</span><span class="p">)</span><span class="w">
</span><span class="n">ch_link</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_create</span><span class="p">(</span><span class="n">plot1</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"timeline"</span><span class="p">)</span><span class="w">
</span><span class="n">ch_link</span><span class="w">
</span></code></pre></div></div>

<iframe src="https://plot.ly/~greenet09/1.embed" width="800" height="600" id="igraph" scrolling="no" seamless="seamless" frameborder="0">
</iframe>

<p>You should be able to click on the legend on the right side to highlight/turn off different categories. Take a moment to play around with it.</p>

<p>And now the world map with Plotly.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">world_maps</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">plot_geo</span><span class="p">(</span><span class="w">
    </span><span class="n">locationmode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'country names'</span><span class="p">,</span><span class="w">  </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="s2">"red"</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">add_markers</span><span class="p">(</span><span class="w">
    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">longitude</span><span class="p">,</span><span class="w">
    </span><span class="n">locations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">Name</span><span class="p">,</span><span class="w">
    </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">paste</span><span class="p">(</span><span class="n">Common.Name</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="n">I</span><span class="p">(</span><span class="m">2</span><span class="p">)</span><span class="w"> 
  </span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">layout</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Violent conflicts since 1400'</span><span class="p">,</span><span class="w"> </span><span class="n">geo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="m">1</span><span class="p">)</span><span class="w">
  
</span><span class="n">options</span><span class="p">(</span><span class="n">browser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'false'</span><span class="p">)</span><span class="w">
  </span><span class="n">chart_link</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_create</span><span class="p">(</span><span class="n">world_maps</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="s2">"choropleth-wm"</span><span class="p">)</span><span class="w">
  </span><span class="n">chart_link</span><span class="w">
</span></code></pre></div></div>

<iframe src="https://plot.ly/~greenet09/3.embed" width="800" height="600" id="igraph" scrolling="no" seamless="seamless" frameborder="0">
</iframe>

<p><strong>Note:</strong> <em>I just need to figure out how to add country borders and get rid of Antarctica.</em></p>

<p>So that’s it for now. The takeaway here is that for normal plotting needs, Plotly works great. But if you have big dataframes of coordinates for world maps, it could be a problem. I’ll need to spend some more time with Plotly for sure.</p>


  </div>

  

  <a class="u-url" href="/datasophy/2018/07/07/global-violence.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/datasophy/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">A Philosopher&#39;s Guide to Data Science</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">A Philosopher&#39;s Guide to Data Science</li><li><a class="u-email" href="mailto:greenet09@gmail.com">greenet09@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/greenet09"><svg class="svg-icon"><use xlink:href="/datasophy/assets/minima-social-icons.svg#github"></use></svg> <span class="username">greenet09</span></a></li><li><a href="https://www.linkedin.com/in/travis-greene"><svg class="svg-icon"><use xlink:href="/datasophy/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">travis-greene</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Discussions around data science, GDPR, law, philosophy, data ethics, big data, and the occasional little data tutorial</p>
      </div>
    </div>

  </div>

</footer>
<script id="dsq-count-scr" src="//https-greenet09-github-io-datasophy.disqus.com/count.js" async></script>
  </body>

</html>
